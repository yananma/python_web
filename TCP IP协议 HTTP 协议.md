
记笔记原则是，一般而言每章记不超过 5 个知识点，多了就没有意义了  


# TCP/IP 协议  

IP 是主机之间的通信，TCP 是进程之间的通信  
IP Internet Protocol 网络层  
TCP Transmission Control Protocol 传输控制协议，传输层  

TCP（Transmission Control Protocol 传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。  

TCP 是一个工作在传输层的可靠数据传输的服务，它能确保接收端接收的网络包是无损坏、无间隔、非冗余和按序的。  


### 三次握手四次挥手 

#### 三次握手
第一次握手：客户端向服务器发送 TCP 连接请求，其中标志 SYN=1，序列号为客户端初始序列号 client_isn，客户端进入 SYN_SEND 状态，等待服务器的确认；  
第二次握手：服务器收到请求后，返回一个应答，其中标志 SYN=1，ACK=1，序列号为服务器初始序列号 server_isn，确认号为客户端初始序列号加 1，即 client_isn+1；此时服务器进入 SYN_RECV 状态；  
第三次握手：客户端再向服务器发送一个确认报文，其中标志 ACK=1。序列号为客户端初始序列号加 1，即 client_isn+1，确认号为服务器初始序列号加 1，即 server_isn+1，客户端和服务器端都进入 ESTABLISHED 状态。  
经过上述 3 次握手后，TCP 连接正式建立。  


#### 四次挥手
第一次挥手：客户端向服务器发送一个 FIN 段，主动关闭客户端到服务器的数据传输，客户端进入 FIN_WAIT_1 状态；  
第二次挥手：服务器收到客户端发送的 FIN 段后，向应用程序发送一个文件结束符，再向客户端发回一个 ACK 段，服务器进入 CLOSE_WAIT 状态，客户端收到 ACK 段后，进入 FIN_WAIT_2 状态；  
第三次挥手：服务器向客户端发送 FIN 段，服务器进入 LAST_ACK 状态；  
第四次挥手：客户端收到服务器发送的 FIN 段，向服务器发回一个 ACK 段，以证实从服务器收到了 FIN 段，然后客户端进入 TIME_WAIT 状态；服务器收到客户端的 ACK 段后，关闭连接；客户端等待 2 个 MSL 后，关闭连接。  


#### 为什么要三次握手
client 发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达 server。本来这是一个早已失效的报文段。但 server 收到此失效的连接请求报文段后，就误认为是 client 再次发出的一个新的连接请求。于是就向 client 发出确认报文段，同意建立连接。假设不采用“三次握手”，那么只要 server 发出确认，新的连接就建立了。由于现在 client 并没有发出建立连接的请求，因此不会理睬 server 的确认，也不会向 server 发送数据。但 server 却以为新的运输连接已经建立，并一直等待 client 发来数据。这样，server 的很多资源就白白浪费掉了。采用“三次握手”的办法可以防止上述现象发生。例如刚才那种情况，client 不会向 server 的确认发出确认。server 由于收不到确认，就知道 client 并没有要求建立连接。”


#### 四次挥手  

TCP协议是一种面向连接的、可靠的、基于字节流的传输层通信协议。TCP 是全双工模式，这就意味着，当客户端发出 FIN 报文段时，只是表示客户端已经没有数据要发送了，客户端告诉服务器，它的数据已经全部发送完毕了；但是，这个时候客户端还是可以接受来自服务器的数据；当服务器返回 ACK 报文段时，表示它已经知道客户端没有数据发送了，但是服务器还是可以发送数据到客户端的；当服务器也发送了 FIN 报文段时，这个时候就表示服务器也没有数据要发送了。  


#### 为什么要等待 2MSL  
网络并不总是可靠的，如果客户端发送的 ACK 段丢失，服务器在接收不到 ACK 的情况下会一直重发 FIN 段。因此客户端为了确保服务器收到了 ACK，会设置一个定时器，并在 TIME-WAIT 状态等待 2MSL 的时间，如果在此期间又收到了来自服务器的 FIN 段，那么客户端会重新设置计时器并再次等待 2MSL 的时间，如果在这段时间内没有收到来自服务器的 FIN 报文，那就说明服务器已经成功收到了 ACK 报文，此时客户端就可以进入 CLOSED 状态了。  



读 60 遍 &emsp; 20/60  


《TCP-IP 协议及其应用》 TCP 章听 5 遍 完成 1 遍  
《网络是怎么连接的》 TCP 章听 5 遍  

sequence number 解决乱序问题  
acknowledgement number 解决丢包问题  
是通过这两个还有校验和来保证传输的可靠性的  

URG，不用在缓存区保留，直接传至对方  


## 《TCP/IP 协议及其应用》  

TCP/IP 协议是目前最完整的、被普遍接受的通信协议标准，无论是局域网还是广域网，TCP/IP 协议都是使用最为广泛的网络协议。  

### 第 1 章 TCP/IP 协议基础  

RFC Request For Comment，是关于 Internet 的一系列注解和文件，是学习和掌握 Internet 知识的最重要的资料。  

看似是对等层交流，本质上还是通过物理通信的  

ARP Adress Resolution Protocol 用于根据 IP 地址获取物理地址  

每台主机都有一个唯一的 IP 地址  

TCP 和 UDP 协议使用端口号来识别应用程序  

排查网络问题的第一步常常是使用 ping 命令来测试网络的连通性。  



### 第 2 章 网络接口层 
最终传输的是电信号  

MAC Media Access Control 介质访问控制  

在生产网卡时，MAC 地址已经被固化在网卡的只读存储器(ROM)中，因此 MAC 地址也常常被称为硬件地址或物理地址。  





# HTTP 协议  




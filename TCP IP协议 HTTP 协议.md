

# TCP/IP 协议  

IP 是主机之间的通信，TCP 是进程之间的通信  
IP Internet Protocol 网络层  
TCP Transmission Control Protocol 传输控制协议，传输层  

TCP（Transmission Control Protocol 传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。  

TCP 是一个工作在传输层的可靠数据传输的服务，它能确保接收端接收的网络包是无损坏、无间隔、非冗余和按序的。  


### 三次握手四次挥手 

#### 三次握手
第一次握手：客户端发送连接请求报文段，将 SYN 位置为 1，并且随机初始化序号 client_isn；然后，客户端进入 SYN_SEND 状态，等待服务器的确认；  
第二次握手：服务器收到客户端的 SYN 报文段，需要对这个SYN报文段进行确认，设置确认应答号为 client_isn+1；同时，自己自己还要发送 SYN 请求信息，将SYN位置为 1，并且随机初始化自己的序列号 server_isn；服务器端将上述所有信息放到 SYN+ACK 报文段中，发送给客户端，此时服务器进入 SYN_RECV 状态；  
第三次握手：客户端收到服务器的 SYN+ACK 报文段。然后将确认应答号设置为 server_isn+1，向服务器发送 ACK 报文段，这个报文段发送完毕以后，客户端和服务器端都进入 ESTABLISHED 状态，完成 TCP三次握手。 
完成了三次握手，客户端和服务器端就可以开始传送数据。以上就是 TCP 三次握手的总体介绍。  

##### 四次挥手
第一次挥手：可以是服务器也可以是客户端，这里假设是客户端，客户端向服务器发送一个 FIN 报文段；此时，客户端进入 FIN_WAIT_1 状态；这表示客户端没有数据要发送给服务器了；  
第二次挥手：服务器收到了客户端发送的 FIN 报文段，向客户端回一个 ACK 报文段，客户端进入 FIN_WAIT_2 状态；  
第三次挥手：服务器向客户端发送 FIN 报文段，请求关闭连接，同时服务器进入 LAST_ACK 状态；  
第四次挥手：客户端收到服务器发送的 FIN 报文段，向服务器发送 ACK 报文段，然后客户端进入 TIME_WAIT 状态；服务器收到客户端的 ACK 报文段以后，就关闭连接；此时，客户端等待 2MSL 后依然没有收到回复，则证明服务器已正常关闭，客户端也关闭连接。  


#### 为什么要三次握手
“三次握手”的目的是“为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误”。  

“已失效的连接请求报文段”的产生在这样一种情况下：client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。本来这是一个早已失效的报文段。但server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求。于是就向client发出确认报文段，同意建立连接。假设不采用“三次握手”，那么只要server发出确认，新的连接就建立了。由于现在client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送数据。但server却以为新的运输连接已经建立，并一直等待client发来数据。这样，server的很多资源就白白浪费掉了。采用“三次握手”的办法可以防止上述现象发生。例如刚才那种情况，client不会向server的确认发出确认。server由于收不到确认，就知道client并没有要求建立连接。”


#### 四次挥手  

TCP协议是一种面向连接的、可靠的、基于字节流的运输层通信协议。TCP 是全双工模式，这就意味着，当客户端发出 FIN 报文段时，只是表示客户端已经没有数据要发送了，客户端告诉服务器，它的数据已经全部发送完毕了；但是，这个时候客户端还是可以接受来自服务器的数据；当服务器返回 ACK 报文段时，表示它已经知道客户端没有数据发送了，但是服务器还是可以发送数据到客户端的；当服务器也发送了 FIN 报文段时，这个时候就表示服务器也没有数据要发送了。  


#### 为什么要等待 2MSL  
网络并不总是可靠的，如果客户端发送的 ACK 报文段丢失，服务器在接收不到 ACK 的情况下会一直重发 FIN 报文段。因此客户端为了确保服务器收到了 ACK，会设置一个定时器，并在 TIME-WAIT 状态等待 2MSL 的时间，如果在此期间又收到了来自服务器的 FIN 报文段，那么客户端会重新设置计时器并再次等待 2MSL 的时间，如果在这段时间内没有收到来自服务器的 FIN 报文，那就说明服务器已经成功收到了 ACK 报文，此时客户端就可以进入 CLOSED 状态了。  



读 60 遍  


《TCP-IP 协议及其应用》 TCP 章听 5 遍 完成 1 遍  
《网络是怎么连接的》 TCP 章听 5 遍  

sequence number 解决乱序问题  
acknowledgement number 解决丢包问题  
是通过这两个还有校验和来保证传输的可靠性的  

URG，不用在缓存区保留，直接传至对方  



# HTTP 协议  



